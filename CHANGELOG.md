# ChangeLog

Список изменений сформирован на основе `git log`.

## port-utils testing

* 10.10.2021 Михаик Краснов <linuxoid85@gmail.com>
    * Добавление начальной документации (`mkdocs`).

* 8.10.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Фикс ключа `--about` - теперь не запрашивается несуществующий для него аргумент.

**Релиз `port-utils v1.0a2`**

* 8.10.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Переход на использование модуля `wget` для скачивания файлов.
    * Изменение поведения функции `update_ports.update_meta()`: теперь функция скачивает метаданные в tmp, проверяет на соответствие update_number с соответствующим номером установленных метаданных, если есть какие-либо отличия, то выводит список обновлённых портов, либо другую информацию. После чего либо копирует метаданные в нужное место, либо завершает работу.
    * Изменение поведения функции `ports.get_file()` - теперь название файла берётся не из параметра `ports_stable`/`ports_unstable`, а комбинирует `ports_stable`/`ports_unstable` + `port_file`.

* 5.10.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление отдельного класса `remove_ports()` для удаления порта из системы.
    * Временное удаление некоторых опций перед релизом версии 1.0a2.
    * Добавление русской локализации.
    * Перенос файлов лога для локального пользователя в директорию `~/.local/var/log`.
    * Завершение работы над классом `build_port()`.

* 2.10.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление в функцию `log_msg()` возможности записи для обычных пользователей, не являющихся `root`. В таком случае запись ведётся в `~/.port-functions.log`.
    * Добавление класса для установки и удаления определённого порта.
    * Добавление класса для работы с базой данных.
    * Добавление функции `port_functions.check_news()` для проверки изменений в Системе портов.
    * Добавление функции для отображения изменений в Системе портов.
    * Добавление функции для проверки совместимости метаданных с установленным релизом CalmiraLinux.
    * Добавление функции `update_ports.update_meta()` для обновления метаданных утилиты.

* 1.10.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление класса `port_functions()` с функциями для очистки системы от временных файлов и просмотра списка изменений в системе портов.

* 29.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Удаление файла `assests/messages.po` за ненадобностью.
    * Замена функций `Update.unpackPkg()` и `Update.installPkg()` на более универсальные `update_ports.unpack_file()` и `update_ports.install_file()`.
        * Функция `update_ports.install_pkg()` принимает два аргумента: что устанавливать (`net_file`) и куда устанавливать (`target_file`).
        * Функция `update_ports.unpack_file()` принимает два аргумента: нужный архив (`file`) и путь, в который этот файл нужно распаковать (`extract_dir`).
        * `update_ports.unpack_file()` теперь не вычисляет, что и куда надо распаковать - за это отвечает функция `update_ports.__init__()`. Тоже самое и с `update_ports.install_file()`
    * Изменение поведения класса `download()`. Теперь он предназначен не только для скачивания файлов, но и для других действий: распаковки и, в будущем, установки пакетов. Обновлённый класс теперь называется `update_ports()`.
    * Функция `download.get_file()` (бывшая `Update.downloadFile()`) использует метаданные (`/usr/share/ports/metadata.json`), в которых приведены ссылки для скачивания стабильных и тестируемых версий Системы портов и документации дистрибутива.
    * В `download.get_file()` добавлены обработчики исключений. Обрабатываются исключения `ConnectionError`, `ConnectionAbortedError` и `FileNotFoundError`.
    * **Рефракторинг кода:**
        * Замена `ports.service.getRoot()` на более простую `check_root()`. У последней нет ненужных режимов работы, а так же при обнаружении запуска не от `root` она завершит работу программы.
        * Замена класса `Update` на несколько более мелких.
        * Замена функции `Update.downloadFile()` для скачивания некоторых файлов на `download.get_file()`.

* 28.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * **Всевозможные крупные изменения:**
        * Замена ключей `--branch` и `-b` на `--update` и `-u` соотв. Предыдущие названия ключей давно устарели, так как port-utils может не только обновлять систему портов, но и многое другое, и старые названия ключей могут казаться неочевидными или неправильными.
    * **Рефракторинг кода.**
        * Функции `Update.checkInstalledPorts()` и `Update.checkArchiveCache()` объединены в одну `check_ports()`, предназначенную для проверки на наличие или отсутствие необходимых файлов для работы port-utils.
        * Отказ от модуля `ports`, который работал не очень корректно.
        * Преимущественное использование обработчиков исключений вместо других конструкций для отслеживания ошибок, что не только упростило код, но и увеличило быстродействие программы.

* 27.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Убран неиспользуемый режим работы функции `about()`;
    * Перенос некоторых классов из программы `port-utils` в отдельный модуль `ports`:
        * Перенос класса `Update` в `ports` -> `update`.

* 26.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Актуализация перевода, добавление файла с настройками программы, другие изменения:
        * Изменение поведения функции `service.printDbg()`: получение данных из json-файла. Теперь debug-сообщения выводятся на экран, если `"debug"` в `/etc/port-utils.json` установлен как `"True"`. Если значение `"debug"` установлено как `"False"`, то сообщение выводится в отдельный файл.
        * Фикс `errors.print_error()` - теперь не выводится сообщение о не найденной ошибке в `errors.json`.
        * По умолчанию отключены функции для установки, удаления и просмотра информации о порте - они будут включены, когда выйдет окончательный релиз port-utils 1.0.
        * Добавление перевода новых строк.
    * Добавление функции для вывода сообщений об ошибке.
        * Используется json-файл с описанием каждой ошибки. В нём находится текст ошибки, её описание и error code.

* 25.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Перенос локализаций в необходимую директорию;
    * Добавление файла с примером issue с багрепортом (на русском языке);
    * Начало рефракторинга кода `port-utils`.

* 23.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление корректных сведений в `assests/calm-release`.

**Релиз `port-utils v1.0a1`**

* 20.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Обновление раздела с примерами файлов;
    * Объединение TODO и Roadmap в README;
    * Добавление опций для установки, удаления и просмотра информации о порте.

* 19.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Обновление локализаций, добавление проверки исключений в `PortFunctions.cleanSys()`;
    * Перенос файлов в отдельную директорию.

* 17.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление функции для проверки пакета на совместимость с Calmira;
    * Обновление локализаций;
    * Добавление функции `files.lock_db()` для блокирования базы данных для других процессов port-utils;
    * Обновление локализаций;
    * Отказ от секции `files` в базе данных:
        * Раньше эта секция использовалась для перечисления установленных файлов порта (в json-конфиге порта, а потом из него переносилась в БД, если нужный порт устанавливался); сейчас она неактуальна и заменена лучшими аналогами.

* 16.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление раздела с примерами конфигов;
    * Добавление функции `InfoPortPKG()` для просмотра информации о порте.

* 15.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление функции `RemovePortPKG()` для полного удаления порта;
    * Добавление вывода ошибки об отсутствии файла (функция `port.remove_port()`);
    * Мелкий рефракторинг `port.remove_port()` - удаление лишнего ветвления;
    * Добавление функции `port.port_remove_from_db()`;
    * Добавление функции `port.remove_port()`;
    * Рефракторинг кода `port.check_port()`; фикс `port.build_port()`; изменение поведения `port.port_add_in_db()`; добавление функции `InstallPortPKG()`:
        * В функции `port.check_port()` произведён небольшой рефракторинг - убраны лишние конструкции; так же функция проверяет наличие всех необходимых файлов.
        * Убран неиспользуемый аргумент `mode` (для выбора режима работы) функции `port.build_port()`.
        * Функция `port.port_add_in_db()` вместо пути к конкретному json-файлу требует только название порта, из которого находит нужный файл.

* 09.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление новых сведений;
    * Обновление сообщений.

* 08.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Фикс функции просмотра чейнжлога портов;
    * Добавление функции добавления порта в базу данных;
    * Добавление функции сборки порта;

* 07.09.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление функции проверки приоритета порта;
    * Первые функции для установки и удаления портов;
    * Фикс чейнжлога;
    * Изменение функции для скачивания файлов, другие незначительные фиксы.

* 01.09.2021 Мизаил Краснов <linuxoid85@gmail.com>
    * Замена табуляций на пробелы;
    * Мелкий рефракторинг кода;

* 29.08.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Мелкие изменения в скрипте и добавление обзорной документации.

* 28.08.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Фикс [#11](https://github.com/CalmiraLinux/port-utils/issues/11);
    * Фикс [#10](https://github.com/CalmiraLinux/port-utils/issues/10);
    * Фикс операторов `print` при использовании `gettext`;
    * Добавление переменной с версией программы;

## port-utils 0.2

* 28.08.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Актуализация README;
    * Окончательная смена имени утилиты;
    * Обновление сообщений и смена названия утилиты;
    * Мелкий фикс отображения информации о программе;
    * Импортирование новых модулей;
    * Добавление новой опции для просмотра информации о программе;
    * Обновление README;
    * Фикс ChangeLog, фикс парсера командной строки, добавление режимов работы функции `checkDirs()` ([#7](https://github.com/CalmiraLinux/update-ports/issues/7)), добавление функции для чтения новостей;
    * Фикс [#5](https://github.com/CalmiraLinux/update-ports/issues/5);
    * Добавление функции для чтения новостей и журнала изменений в портах, а так же фикс багов.

* 27.08.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Добавление нового класса; добавление функции для проверки на существование файлов, добавление функции для очистки системы от временных файлов;
    * Добавление новых строк для перевода; добавлен выход из скрипта с кодом завершения `0` после просмотра списка веток портов (`--tree list`);
    * Добавление списка веток портов ([#3](https://github.com/CalmiraLinux/update-ports/issues/3));
    * Перевод скрипта;
    * Добавление примера перевода;
    * Добавление поддержки `gettext`; добавление русской локализации;
	* Добавление информации о зависимостях.

## update-ports 0.1

* 27.08.2021 Михаил Краснов <linuxoid85@gmail.com>
    * Удаление ненужного файла;
	* Добавление Changelog;
	* Добавление Makefile;
	* Фикс функции `getDate()`: теперь из-за неё не падает весь скрипт; фикс `printDbg`: теперь запись в лог корректная;
	* Добавление опций {`--debug`,`-d`} для отображения debug-сообщений (`Other.printDbg`). По умолчанию отображение таких сообщений выключено;
	* Обеспечение совместимости с Calmira;
	* Фикс функции `installPort()`: теперь порты ставятся в нужную `/usr/ports`, а не `/usr/ports/ports`.

* 26.08.2021 Михаил Краснов <linuxoid85@gmail.com>
	* Фикс функции `installPort()`: теперь файлы копируются правильно;
	* Мелкие фиксы функций, добавление debug-сообщений (на время разработки) и проверки на запуск от имени пользователя `root`;
	* Мелкие фиксы парсера командной строки;
	* Добавление файла README, выкладывание исходного кода на GitHub;
	* Добавление парсера командной строки и конечной части скрипта;
	* Добавление функции для установки порта;
	* Добавление функции для распаковки порта;
	* Initial commit.
