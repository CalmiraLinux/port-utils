# Применение модуля ports_manage

Модуль `ports_manage` содержит функции для установки и удаления портов.

## Возможности

* Работа с портами:
    * Установка:
        * Сборка;
        * Добавление в базу данных;
    * Удаление:
        * Удаление;
        * Вынос записи из базы данных;
    * Обновление:
        * Пересборка;
        * Изменение записи в базе данных;
    * Просмотр информации:
        * Парсинг JSON-файла с информацией.

## Независимые функции

| Прототип | Описание | Принимаемые параметры | Возвращаемые значения |
|----------|----------|-----------------------|-----------------------|
| [`dialog_msg(message, mode="none", return_code=0)`](../ports_manage/functions/dialog_msg/) | Функция для печати диалоговых сообщений в `stdout`. Пользователь должен ввести Y/y для подтверждения, либо n/N для отклонения. Ответы содержатся в переменной `run`. Если выбран режим работы `exit`, то провоцируется выход из программы, если режим не указан, либо установлен любой другой, то функция завершает работу, не спровоцировав выход | `message` - текст сообщения; `mode` - режим работы (`exit` - для выхода из программы); `return_code` - код выхода из программы | Выход с кодом `return_code`, если режим работы (`mode`) = `exit`; возвращение значения `True` функции, если отвечено Y или y и не выбран режим `exit`, возвращение значения `False` функции, если выбрано N/n (или любые другие значения `run`) и не выбран режим `exit`. Выход из программы, в таком случае, не провоцируется |

## Классы

### 1. port_info

`port_info()` используется для получения информации о пакете порта.

**Функции класса:**

| Прототип | Описание | Принимаемые параметры | Возвращаемые значения |
|----------|----------|-----------------------|-----------------------|
| [`print_item(msg, param)`](../ports_manage/classes/port_info/print_item/) | Проверяет наличие параметра `param` в `config.json` порта, если параметр существует, то выводит в stdout строку типа `msg: param` | `msg` - сообщение, выводимое на экран в случае наличия параметра `param` | `True` в случае наличия параметра, `False` - в случае отсутствия |
| `getall(port)` | Получение всех параметров `config.json` порта `port` | `port` - `str`. Имя порта, включающее категорию, подкатегорию (если есть) и название. Например, `base/editors/vim`. | `True`, если порт и его `config.json` существует, `False`, если нет |

### 2. build_ports

`build_ports()` используется для сборки портов, либо их удаления.

**Функции класса:**

| Прототип | Описание | Принимаемые параметры | Возвращаемые значения |
|----------|----------|-----------------------|-----------------------|
| `check(port, mode)` | Проверяет порт на готовность к выполнению установки или удаления | `port` - имя порта (например, `base/editors/vim`); `mode` - режим работы (`install` - проверка на готовность к установке, `remove` - проверка на готовность к удалению) | `True`/`False` |
| `get_release(port)` | Возвращает значение `release` из config.json порта | `port` - имя порта (например, `base/editors/vim`) | `relese` - str |
| `get_calm_release()` | Возвращает версию дистрибутива CalmiraLinux | Никаких | Никаких |
| `build(port)` | Выполняет сборку порта. С помощью `build_ports.check()` проверяет наличие файлов `config.json` и `install`, затем выполняет содержимое `install` | `port` - имя порта (например, `base/editors/vim`) | Код завершения скрипта `install` |
| `add_in_db(port)` | Добавляет порт `port` в базу данных системы портов (структуру БД смотрите в приложении 1) | `port` - имя порта | Никаких |
| `remove(port)` | Выполняет инструкции по удалению порта. В директории порта обязательно должен присутствовать файл `remove` | `port` - имя порта | Код завершения скрипта `remove` |

***

## Приложения

### Приложение 1. Структура базы данных портов

Информация об установленных портах содержится в базе данных `/var/db/ports/ports.db` (`DB`). Тип: SQLite3 DataBase. Туда добавляются следующие сведенья:

- Имя порта;
- Версия порта;
- Сопровождающий порта;
- Релиз CalmiraLinux, для которого предназначен порт;
- Дату добавления порта в базу данных в формате: `День недели Месяц Число ЧЧ:ММ:СС ГГГГ`.

Все остальные данные можно извлечь из `config.json` порта.