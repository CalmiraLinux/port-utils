# Применение модуля update_ports

Модуль `update_ports` содержит функции для обновление метаданных и системы портов CalmiraLinux.

## Классы

### 1. settings

Класс `settings()` используется для работы с файлом настройки.

**Функции класса**

| Прототип | Описание | Принимаемые параметры | Возвращаемые значения |
|----------|----------|-----------------------|-----------------------|
| `check_file()` | Функция для проверки наличия файла и корректности содержащихся в нём параметров | Никаких | `True` если всё впорядке, `False` если файл не найден или какой-либо из параметров неверен |
| `get(param)` | Функция для получения значения одного из параметров (из файла) | `param` - название параметра | `str`/`bool` |

### 2. fetch_metadata

Класс `fetch_metadata()` содержит функции для обновления метаданных утилиты.

**Функции класса**

| Прототип | Описание | Принимаемые параметры | Возвращаемые значения |
|----------|----------|-----------------------|-----------------------|
| `parse(file)` | Возвращает значения параметров из JSON-файла | `file` - нужный JSON-файл | Объекты Python - словари, списки и т.д. |
| `get_metadata(branch)` | Скачивает файл с метаданными из репозиториев Calmira | `branch` - ветка, с которой требуется скачать метаданные (`stable` или `testing`) | Никаких |
| `get_updt_num(file)` | Возвращает значение параметра `update_number` из файла с метаданными | `file` - путь до JSON-файла с метаданными | `int` |
| `get_difference()` | Возвращает значение вычислений `update_number` из установленных и скачанных метаданных. Если = 0, то обновлений нет, если > 0, то обновления есть, если < 0, то выполняется даунгрейд с тестовой на стабильную ветку | Никаких | `str`. "downgrade" в случае даунгрейда, "update" в случае наличия обновлений, "no_updates" в случае отсутствия изменений |
| `install_metadata()` | Устанавливает скачанные метаданные | Никаких | `bool`. `True` в случае удачной установки, `False` в случае ошибки |

### 3. fetch_ports

Класс `fetch_ports()` содержит функции для обновления системы портов дистрибутива CalmiraLinux.

**Функции класса**

| Прототип | Описание | Принимаемые параметры | Возвращаемые значения |
|----------|----------|-----------------------|-----------------------|
| `check_archive()` | Удаляет ненужные файлы, мешающие обновлению | Никаких | Никакие |
| `get_ports()` | Скачивает архив с системой портов. Адрес и необходимую ветку берёт из параметров (`settings.get()`) | Никаких | Никакие |
| `install_ports()` | Распаковывает архив со скачанным архивом системы портов, затем устанавливает из него необходимые файлы | Никаких | Никакие |

## Требуемые параметры

> **Примечание:** параметры берутся из файла `/etc/port-utils.json`.

| Параметр | Описание | Возможные значения |
|----------|----------|--------------------|
| `repo`   | Адрес репозитория | Изменять значение этого параметра не советуется |
| `branch` | Ветка репозитория, из которого скачиваются требуемые файлы | `stable` - стабильная ветка, `testing` - нестабильная ветка |
| `downgrade_with_fetch` | Позволяет или запрещает даунгрейд системы портов/метаданных при обновлении или смене ветки | `true`/`false` |